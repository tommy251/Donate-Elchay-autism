document.getElementById('donationForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const amount = document.getElementById('amount').value;
    const message = document.getElementById('message');

    // Send request to backend to initialize payment
    fetch('/pay', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            'name': name,
            'email': email,
            'amount': amount
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            const authorizationUrl = data.data.authorization_url;
            const reference = data.data.reference;

            // Open Paystack payment popup
            const handler = PaystackPop.setup({
                key: paystackKey,
                email: email,
                amount: amount * 100,
                ref: reference,
                metadata: {
                    name: name,
                    amount: amount
                },
                onClose: function () {
                    message.textContent = 'Payment window closed.';
                },
                callback: function (response) {
                    // Redirect to the verify-payment endpoint
                    window.location.href = `/verify-payment?reference=${response.reference}&name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&amount=${amount}`;
                }
            });
            handler.openIframe();
        } else {
            message.textContent = data.message || 'Error initializing payment. Please try again.';
        }
    })
    .catch(error => {
        message.textContent = 'An error occurred. Please try again.';
        console.error('Error:', error);
    });
});